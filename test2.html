<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }

        html,
        body {
            width: 100%;
            height: 100%;
        }

        #root {
            width: 100%;
            height: 100%;
        }

        .code {
            width: 100%;
            display: block;
            height: 25px;
        }

        .codeInfo {
            width: 100px;
            height: 25px;
            border: 1px solid black;
            display: inline-block;
        }

        .key {
            width: 25px;
            height: 25px;
            border: 1px solid black;
            display: inline-block;
        }
    </style>
</head>

<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/15.1.3/Tone.js"></script>
    <script>
        const sampler = new Tone.Sampler({
            urls: {
                "A0": "./sound/1.mp3",
                "A#0": "./sound/2.mp3",
                "B0": "./sound/3.mp3",
                "C1": "./sound/4.mp3",
                "C#1": "./sound/5.mp3",
                "D1": "./sound/6.mp3",
                "D#1": "./sound/7.mp3",
                "E1": "./sound/8.mp3",
                "F1": "./sound/9.mp3",
                "F#1": "./sound/10.mp3",
                "G1": "./sound/11.mp3",
                "G#1": "./sound/12.mp3",
                "A1": "./sound/13.mp3",
                "A#1": "./sound/14.mp3",
                "B1": "./sound/15.mp3",
                "C2": "./sound/16.mp3",
                "C#2": "./sound/17.mp3",
                "D2": "./sound/18.mp3",
                "D#2": "./sound/19.mp3",
                "E2": "./sound/20.mp3",
                "F2": "./sound/21.mp3",
                "F#2": "./sound/22.mp3",
                "G2": "./sound/23.mp3",
                "G#2": "./sound/24.mp3",
                "A2": "./sound/25.mp3",
                "A#2": "./sound/26.mp3",
                "B2": "./sound/27.mp3",
                "C3": "./sound/28.mp3",
                "C#3": "./sound/29.mp3",
                "D3": "./sound/30.mp3",
                "D#3": "./sound/31.mp3",
                "E3": "./sound/32.mp3",
                "F3": "./sound/33.mp3",
                "F#3": "./sound/34.mp3",
                "G3": "./sound/35.mp3",
                "G#3": "./sound/36.mp3",
                "A3": "./sound/37.mp3",
                "A#3": "./sound/38.mp3",
                "B3": "./sound/39.mp3",
                "C4": "./sound/40.mp3",
                "C#4": "./sound/41.mp3",
                "D4": "./sound/42.mp3",
                "D#4": "./sound/43.mp3",
                "E4": "./sound/44.mp3",
                "F4": "./sound/45.mp3",
                "F#4": "./sound/46.mp3",
                "G4": "./sound/47.mp3",
                "G#4": "./sound/48.mp3",
                "A4": "./sound/49.mp3",
                "A#4": "./sound/50.mp3",
                "B4": "./sound/51.mp3",
                "C5": "./sound/52.mp3",
                "C#5": "./sound/53.mp3",
                "D5": "./sound/54.mp3",
                "D#5": "./sound/55.mp3",
                "E5": "./sound/56.mp3",
                "F5": "./sound/57.mp3",
                "F#5": "./sound/58.mp3",
                "G5": "./sound/59.mp3",
                "G#5": "./sound/60.mp3",
                "A5": "./sound/61.mp3",
                "A#5": "./sound/62.mp3",
                "B5": "./sound/63.mp3",
                "C6": "./sound/64.mp3",
                "C#6": "./sound/65.mp3",
                "D6": "./sound/66.mp3",
                "D#6": "./sound/67.mp3",
                "E6": "./sound/68.mp3",
                "F6": "./sound/69.mp3",
                "F#6": "./sound/70.mp3",
                "G6": "./sound/71.mp3",
                "G#6": "./sound/72.mp3",
                "A6": "./sound/73.mp3",
                "A#6": "./sound/74.mp3",
                "B6": "./sound/75.mp3",
                "C7": "./sound/76.mp3",
                "C#7": "./sound/77.mp3",
                "D7": "./sound/78.mp3",
                "D#7": "./sound/79.mp3",
                "E7": "./sound/80.mp3",
                "F7": "./sound/87.mp3",
                "F#7": "./sound/82.mp3",
                "G7": "./sound/83.mp3",
                "G#7": "./sound/84.mp3",
                "A7": "./sound/85.mp3",
                "C8": "./sound/86.mp3",
                "C#8": "./sound/87.mp3",
            },// envelope: {
            //     attack: 0.1,    // 소리가 빠르게 시작
            //     decay: 0.3,     // 일정 시간 동안 감소
            //     sustain: 1,     // 지속 시간 최대
            //     release: 3      // 키를 떼면 3초 동안 소리가 서서히 사라짐
            // },
            onload: () => {
                console.log("All samples loaded");
            }
        }).toDestination();
    </script>
    <script>
        let obj = {
            "cMajor": ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"],
            "cSharpMajor": ["C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B", "C"],
            "dMajor": ["D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B", "C", "C#"],
            "dSharpMajor": ["D#", "E", "F", "F#", "G", "G#", "A", "A#", "B", "C", "C#", "D"],
            "eMajor": ["E", "F", "F#", "G", "G#", "A", "A#", "B", "C", "C#", "D", "D#"],
            "fMajor": ["F", "F#", "G", "G#", "A", "A#", "B", "C", "C#", "D", "D#", "E"],
            "fSharpMajor": ["F#", "G", "G#", "A", "A#", "B", "C", "C#", "D", "D#", "E", "F"],
            "gMajor": ["G", "G#", "A", "A#", "B", "C", "C#", "D", "D#", "E", "F", "F#"],
            "gSharpMajor": ["G#", "A", "A#", "B", "C", "C#", "D", "D#", "E", "F", "F#", "G"],
            "aMajor": ["A", "A#", "B", "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#"],
            "aSharpMajor": ["A#", "B", "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A"],
            "bMajor": ["B", "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#"],

            "cMinor": ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"],
            "cSharpMinor": ["C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B", "C"],
            "dMinor": ["D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B", "C", "C#"],
            "dSharpMinor": ["D#", "E", "F", "F#", "G", "G#", "A", "A#", "B", "C", "C#", "D"],
            "eMinor": ["E", "F", "F#", "G", "G#", "A", "A#", "B", "C", "C#", "D", "D#"],
            "fMinor": ["F", "F#", "G", "G#", "A", "A#", "B", "C", "C#", "D", "D#", "E"],
            "fSharpMinor": ["F#", "G", "G#", "A", "A#", "B", "C", "C#", "D", "D#", "E", "F"],
            "gMinor": ["G", "G#", "A", "A#", "B", "C", "C#", "D", "D#", "E", "F", "F#"],
            "gSharpMinor": ["G#", "A", "A#", "B", "C", "C#", "D", "D#", "E", "F", "F#", "G"],
            "aMinor": ["A", "A#", "B", "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#"],
            "aSharpMinor": ["A#", "B", "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A"],
            "bMinor": ["B", "C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#"]
        };
        // console.log(obj.cMajor);

    </script>
    <div id="root">
    </div>
    <script>
        // console.log(Object.keys(obj));
        let array = Object.keys(obj);
        let root = document.getElementById('root');
        Object.keys(obj).forEach(element => {
            // console.log(element);
            let codeElement = document.createElement('div');
            let codeInfo = document.createElement('div');
            codeInfo.className = 'codeInfo'
            codeInfo.innerHTML = element;
            codeElement.appendChild(codeInfo);
            codeElement.id = element;
            codeElement.className = 'code';
            let keyArray = obj[element];
            // console.log(keyArray);
            keyArray.forEach(key => {
                let keyElement = document.createElement('div');
                // keyElement.id = 
                keyElement.className = 'key';
                keyElement.innerHTML = key;
                codeElement.appendChild(keyElement);
            });
            codeInfo.addEventListener('click', selectCode)
            root.appendChild(codeElement);
        });
        let inputKeyArray = [
            "1", "!", "2", "@", "3",
            "4", "$", "5", "%", "6",
            "^", "7", "8", "*", "9",
            "(", "0", "q", "Q", "w",
            "W", "e", "E", "r", "t",
            "T", "y", "Y", "u", "i",
            "I", "o", "O", "p", "P",
            "a", "s", "S", "d", "D",
            "f", "g", "G", "h", "H",
            "j", "J", "k", "l", "L",
            "z", "Z", "x", "c", "C",
            "v", "V", "b", "B", "n",
            "m", "M",
        ]
        let keyMap = new Map();  // Move this outside so it's persistent

        function selectCode(e) {
            keyMap.clear();  // Clear previous key mappings each time a new scale is selected
            let codeElement = e.target;
            console.log(codeElement);
            let keyArray = obj[codeElement.innerHTML];
            console.log(keyArray);
            console.log(inputKeyArray);
            let idx = 0;
            for (let i = 2; i <= 8; i++) {
                let output = "";
                for (let j = 0; j < keyArray.length && idx < inputKeyArray.length; j++) {
                    output += `{${inputKeyArray[idx]} : ${keyArray[j] + i}}, `;
                    keyMap.set(inputKeyArray[idx], keyArray[j] + i);  // Update the map
                    idx++;
                }
                console.log(output);
            }
            console.log(keyMap);
        }

        document.addEventListener('keydown', function (e) {
            console.log(e.key);
            if (keyMap.has(e.key)) {  // Check if the key is in the map
                console.log(keyMap.get(e.key));  // Log the mapped note
                if (!e.repeat) {
                    sampler.triggerAttackRelease(keyMap.get(e.key), "2n");
                }
            }
        });

    </script>
</body>

</html>